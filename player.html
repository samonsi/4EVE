<!DOCTYPE html>
<html>
<head>
    <title>สมรศรี - Live TV</title>
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,shrink-to-fit=no">
    <link rel="stylesheet" href="style.css">
</head>
<body><!DOCTYPE html>
<html>
<head>
    <title>PLAYIDTV - Player</title>
    <style>
        body {
            background-color: #000;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
        #player-container {
            width: 100%;
            height: 100%;
        }
        #player {
            width: 100%;
            height: 100%;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/@clappr/player@0.4.0/dist/clappr.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/shaka-player@2.5.10/dist/shaka-player.compiled.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/clappr/dash-shaka-playback@latest/dist/dash-shaka-playback.external.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/level-selector@latest/dist/level-selector.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/clappr-audio-selector@latest/dist/clappr-audio-selector.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/clappr-pip-plugin@latest/dist/clappr-pip-plugin.min.js"></script>
</head>
<body>
    <div id="player-container">
        <div id="player"></div>
    </div>
    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const source = urlParams.get('source');
        const keyId = urlParams.get('keyId');
        const keyValue = urlParams.get('keyValue');
        const mimeType = urlParams.get('mimeType');
        const channelName = decodeURIComponent(urlParams.get('channelName'));

        if (source) {
            // Add CORS Proxy to the video source URL directly
            const proxyUrl = "https://api.allorigins.win/raw?url=";
            const finalSource = source.startsWith("http") ? proxyUrl + encodeURIComponent(source) : source;

            let plugins = [LevelSelector, DashShakaPlayback];
            if (typeof ClapprAudioSelector !== 'undefined') plugins.push(ClapprAudioSelector);
            if (typeof PipPlugin !== 'undefined') plugins.push(PipPlugin);

            const playerConfig = {
                source: finalSource, // Use the proxied URL
                autoPlay: true,
                height: '100%',
                width: '100%',
                plugins: plugins,
                parentId: '#player',
            };

            if (mimeType) playerConfig.mimeType = mimeType;
            if (keyId && keyValue) {
                playerConfig.shakaConfiguration = {
                    drm: {
                        clearKeys: {
                            [keyId]: keyValue
                        }
                    }
                };
            }

            const playerInstance = new Clappr.Player(playerConfig);
            document.title = 'PLAYIDTV - ' + channelName;
        } else {
            document.getElementById('player-container').innerHTML = '<h2>Video source not found.</h2>';
        }
    </script>
</body>
</html>
    <div id="video-player-row">
        <div id="video-player-container">
            </div>
    </div>
    
    <div id="controls-row">
        <div id="controls-section">
            <a href="https://movies-sandy-chi.vercel.app/index.html" target="_blank" class="external-link-btn">
                ดูหนัง
            </a>
            <button id="manage-playlists-btn">Playlists</button>
            <select id="playlist-selector"></select>
        </div>
    </div>

    <div id="main-content">
        <div id="group-tabs-row">
            <div id="group-tabs">
            </div>
        </div>
        
        <div id="channel-list-row">
            <div id="channel-list">
                <p>Loading channels...</p>
            </div>
        </div>
    </div>
    
    <div id="custom-playlist-menu">
        <div class="menu-content">
            <h3>Playlists Manager </h3>
            
            <div class="add-playlist-section">
                <input type="text" id="new-playlist-name" placeholder="Playlist Name">
                <input type="text" id="new-playlist-source" placeholder="URL or Local File (e.g., playlist/file.m3u)">
                <button id="add-playlist-btn">Add Playlist</button>
            </div>
            
            <div id="playlist-list-container">
                <ul id="playlist-list">
                    </ul>
            </div>

            <button id="close-menu-btn">Done</button>
        </div>
    </div>
    
    <script src="main.js"></script>
</body>

</html>

